<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <style>
        /* Your existing styles here */
    </style>
</head>
<body>
    <!-- Your existing HTML here -->

    <script>
        // Your existing JavaScript here

        // Google Sign-In success callback ichida, localStorage.setItem('user', displayName) dan keyin qo'shing:
        function onGoogleSignIn(googleUser) {
            const profile = googleUser.getBasicProfile();
            const displayName = profile.getName();
            localStorage.setItem('user', displayName);

            // Check if user is blocked after registration
            setTimeout(async () => {
                await checkUserBlock();
            }, 1000);
        }

        // Block tekshirish funksiyasini ham qo'shing:
        async function checkUserBlock() {
            const user = localStorage.getItem('user');
            if (!user) return false;

            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getDatabase, ref, get, remove } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyA_B0OC6Y91ontwJWM-o615jg7Dr5jUVvA",
                    authDomain: "dizaynowner.firebaseapp.com",
                    databaseURL: "https://dizaynowner-default-rtdb.firebaseio.com/",
                    projectId: "dizaynowner",
                    storageBucket: "dizaynowner.firebasestorage.app",
                    messagingSenderId: "976762018041",
                    appId: "1:976762018041:web:e43227005165059158ea28"
                };

                const app = initializeApp(firebaseConfig);
                const database = getDatabase(app);

                const blockedRef = ref(database, `blocked_users/${user}`);
                const snapshot = await get(blockedRef);
                
                if (snapshot.exists()) {
                    const blockData = snapshot.val();
                    const now = new Date().getTime();
                    const blockEndTime = new Date(blockData.blockEndTime).getTime();
                    
                    if (now < blockEndTime) {
                        const remainingTime = Math.ceil((blockEndTime - now) / 1000 / 60);
                        showBlockModal(blockData.reason, remainingTime, blockData.blockEndTime);
                        return true;
                    } else {
                        await remove(blockedRef);
                        return false;
                    }
                }
                
                return false;
            } catch (error) {
                console.error('Block tekshirishda xatolik:', error);
                return false;
            }
        }

        function showBlockModal(reason, remainingMinutes, blockEndTime) {
            const modal = document.createElement('div');
            modal.id = 'blockModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(20px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.5s ease;
            `;
            
            const endDate = new Date(blockEndTime);
            const formattedEndTime = endDate.toLocaleString('uz-UZ');
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                    border-radius: 2rem;
                    padding: 3rem;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    color: white;
                    box-shadow: 0 20px 60px rgba(239, 68, 68, 0.3);
                    border: 2px solid rgba(255, 255, 255, 0.1);
                    animation: modalSlide 0.8s ease;
                ">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üö´</div>
                    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 1rem; color: white;">
                        Hisobingiz bloklangan!
                    </h2>
                    
                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1.5rem; margin: 2rem 0; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <h3 style="color: #fecaca; margin-bottom: 1rem; font-size: 1.2rem;">üìù Block sababi:</h3>
                        <p style="font-size: 1.1rem; line-height: 1.6; color: white; font-weight: 500;">
                            ${reason}
                        </p>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1.5rem; margin: 2rem 0; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <h3 style="color: #fecaca; margin-bottom: 1rem; font-size: 1.2rem;">‚è∞ Qolgan vaqt:</h3>
                        <p id="remainingTime" style="font-size: 1.5rem; font-weight: 700; color: #fef2f2;">
                            ${remainingMinutes} daqiqa
                        </p>
                        <p style="font-size: 0.9rem; color: #fecaca; margin-top: 0.5rem;">
                            Block tugash vaqti: ${formattedEndTime}
                        </p>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <p style="font-size: 0.9rem; color: #fecaca; margin-bottom: 1rem;">
                            ‚ö†Ô∏è Bu vaqt tugagach avtomatik ravishda blokdan chiqasiz
                        </p>
                        <button onclick="window.location.href='/'" style="
                            background: rgba(255, 255, 255, 0.2);
                            color: white;
                            border: 2px solid rgba(255, 255, 255, 0.3);
                            padding: 1rem 2rem;
                            border-radius: 1rem;
                            font-size: 1rem;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-family: 'Poppins', sans-serif;
                        " onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                            üè† Bosh sahifaga qaytish
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const updateTimer = setInterval(async () => {
                const now = new Date().getTime();
                const blockEnd = new Date(blockEndTime).getTime();
                const remaining = Math.ceil((blockEnd - now) / 1000 / 60);
                
                if (remaining <= 0) {
                    clearInterval(updateTimer);
                    modal.remove();
                    window.location.href = '/';
                } else {
                    const timeElement = document.getElementById('remainingTime');
                    if (timeElement) {
                        if (remaining >= 60) {
                            const hours = Math.floor(remaining / 60);
                            const minutes = remaining % 60;
                            timeElement.textContent = `${hours} soat ${minutes} daqiqa`;
                        } else {
                            timeElement.textContent = `${remaining} daqiqa`;
                        }
                    }
                }
            }, 60000);
            
            document.body.style.overflow = 'hidden';
            
            modal.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
    </script>
</body>
</html>
